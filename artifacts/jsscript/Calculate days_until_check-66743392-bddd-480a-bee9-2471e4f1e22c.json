{
	"id": "66743392-bddd-480a-bee9-2471e4f1e22c",
	"createdAt": "2021-03-24T11:48:04.000Z",
	"createdBy": "lloyd",
	"globalScripts": [],
	"externalModules": [
		{
			"id": "internal_moment",
			"name": "moment",
			"contextname": "moment",
			"path": "moment"
		}
	],
	"entitySets": [
		{
			"id": "988B3DAD-64AB-4137-8B22-7C84B30685B3",
			"name": "equipment",
			"contextname": "equipment"
		}
	],
	"apis": [],
	"name": "Calculate days_until_check",
	"ver": "21.3.29.1134",
	"description": null,
	"content": [
		"==OBJECT STRING==",
		"// -----",
		"",
		"// For each piece of equipment, get the \"checkup_date\" and add the \"checkup_interval\" to it",
		"// This gives the date the equipment needs to be checked next.",
		"",
		"// Compare this date with the current date, to generate the \"days_until_check\" variable",
		"// Update each piece of equipment with this variable.",
		"",
		"// -----",
		"",
		"// Import Moment",
		"var moment = modules.moment;",
		"",
		"// Use moment to get current day:",
		"var currentDate = moment(new Date(), \"YYYY-MM-DD\");",
		"console.log(\"Current date:\",currentDate)",
		"",
		"",
		"// Get all the records from the equipment database",
		"const equipmentTable = await entities.equipment.createQueryBuilder(\"alias\").getMany();",
		"",
		"// For each record in the equipment database",
		"for (i = 0; i < equipmentTable.length; i++) {",
		"    console.log(\"-----\");",
		"",
		"    var checkup_date = moment(equipmentTable[i].checkup_date, \"YYYY-MM-DD\");",
		"    var checkup_interval =  equipmentTable[i].checkup_interval;",
		"    console.log(checkup_date);",
		"    console.log(checkup_interval);",
		"",
		"    var date_of_the_next_check = moment(checkup_date).add(checkup_interval, 'days');",
		"    console.log(date_of_the_next_check);",
		"",
		"    //Difference in number of days",
		"    var days_left = Math.round(moment.duration(date_of_the_next_check.diff(currentDate)).asDays());",
		"    console.log(days_left);",
		"",
		"    await entities.equipment.update({part_number: equipmentTable[i].part_number}, {days_until_check: days_left});",
		"",
		"}",
		"",
		"complete();"
	],
	"useAsGlobalScript": false,
	"isTypescript": false,
	"transpiledContent": null,
	"lastRunSuccessful": true,
	"jsscriptGroup": "e891cad6-6eb4-4711-b05e-dd1234c0cbff",
	"package": "1d063863-5ccb-42c8-a7df-323605fe1ee3"
}