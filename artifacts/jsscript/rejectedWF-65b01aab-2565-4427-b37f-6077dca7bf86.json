{
	"id": "65b01aab-2565-4427-b37f-6077dca7bf86",
	"createdAt": "2021-04-06T13:48:55.000Z",
	"createdBy": "james",
	"globalScripts": [],
	"externalModules": [
		{
			"id": "1227f872-d9c3-4e5d-9358-d99692daebaa",
			"name": "uuid",
			"contextname": "uuid",
			"path": "/home/planet9/ext-disk/npm-serverscript/node_modules/uuid"
		}
	],
	"entitySets": [
		{
			"id": "473F3569-67AB-46B6-89E6-F2D3F11F937C",
			"name": "inspections",
			"contextname": "inspections"
		}
	],
	"apis": [],
	"name": "rejectedWF",
	"ver": "21.8.12.1427",
	"description": null,
	"content": [
		"==OBJECT STRING==",
		"// Refer to this log (\"System Logs\" tool) to see the objectKey of the approved workflow",
		"log.info(wfData);",
		"// wfData.objectKey = Equipment Part Number",
		"",
		"",
		"// First, grab the data for the given inspection",
		"const inspection = await entities.inspections.createQueryBuilder()",
		"    .where(\"part_number = :part_number\", {part_number: wfData.objectKey})",
		"    .andWhere(\"status = :status\", {status: \"Submitted\"})",
		"    .getOne();",
		"// Hold submitted data in \"inspection\" variable",
		"",
		"",
		"// Change the current \"Submitted\" Inspection 'status' to \"Rejected\"",
		"const table = entities.inspections;",
		"await table.createQueryBuilder().update()",
		"    .set({\"status\":\"Rejected\"})",
		"    .where(\"part_number = :part_number\", {part_number: wfData.objectKey})",
		"    .andWhere(\"status = :status\", {status: \"Submitted\"})",
		"    .execute();",
		"// ---",
		"log.info(\"Updated currently Submitted inspection to Rejected\");",
		"",
		"",
		"var uuidGenerator = modules.uuid.v4;",
		"// CREATE A NEW Inspection with status \"Assigned\"",
		"// But with blank fields for the 4 inspection data points",
		"await entities.inspections.createQueryBuilder()",
		"    .insert()",
		"    .values({",
		"        \"employeeID\":inspection.employeeID,",
		"        \"employeeName\":inspection.employeeName,",
		"        \"part_number\":inspection.part_number,",
		"        \"status\":\"Assigned\",",
		"        \"equipment_barcode_scan\":\"\",",
		"        \"comments\":\"\",",
		"        \"attachments\":\"\",",
		"        \"signature\":\"\",",
		"        \"createdAt\":Date.now(),",
		"        \"updatedAt\":Date.now(),",
		"        \"createdBy\":\"system\",",
		"        \"updatedBy\":\"system\",",
		"        \"id\":uuidGenerator() // <- Here we use the uuidGeneartor module",
		"        })",
		"    .execute();",
		"",
		"const entity = entities.inspections.create();",
		"",
		"log.info(\"Inserted new Inspection record as Assigned\");",
		"",
		"complete();"
	],
	"useAsGlobalScript": false,
	"isTypescript": false,
	"transpiledContent": null,
	"lastRunSuccessful": true,
	"jsscriptGroup": "089a48c6-6626-4c48-aade-68129c29a97b",
	"package": "1d063863-5ccb-42c8-a7df-323605fe1ee3"
}